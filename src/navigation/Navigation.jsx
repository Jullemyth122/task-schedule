import React, { useEffect, useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';  // Use useNavigate from React Router v6
import { getAuth, signOut } from 'firebase/auth'; // Import Firebase auth

const Navigation = () => {
    const [user, setUser] = useState(null); // State to store user data
    const navigate = useNavigate(); // useNavigate hook to navigate programmatically

    useEffect(() => {
        console.log(user)
        // Check if user is already logged in (Firebase Authentication persistence)
        const auth = getAuth();
        const unsubscribe = auth.onAuthStateChanged((currentUser) => {
            if (currentUser) {
                setUser(currentUser); // Set the user data in state
            } else {
                setUser(null); // No user is signed in
            }
        });

        return () => unsubscribe(); // Cleanup subscription on unmount
    }, []);

    const handleLogout = async () => {
        try {
            const auth = getAuth();
            await signOut(auth); // Sign out the user from Firebase
            localStorage.removeItem("user"); // Remove user data from localStorage (if used)
            navigate('/signup'); // Redirect to the login page using useNavigate
        } catch (error) {
            console.error("Error logging out:", error.message);
        }
    };

    return (
        <div className='navigator-comp w-full'>
            <ul className='flex items-center justify-between gap-3 h-full'>
                <div className="nav-side">
                    <h3 className='txt1'> T 4 S K </h3>
                    <h3 className='absolute txt2'> T 4 S K </h3>
                </div>
                <div className="nav-side flex items-center justify-evenly gap-5 px-5 m-0 h-full">
                    <Link className='nav-link' to={'/home'}>
                        <svg width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.9401 7.50089C17.9401 7.36829 17.8874 7.24111 17.7936 7.14734C17.6999 7.05357 17.5727 7.00089 17.4401 7.00089C17.3075 7.00089 17.1803 7.05357 17.0865 7.14734C16.9928 7.24111 16.9401 7.36829 16.9401 7.50089H17.9401ZM3.94008 7.50089C3.94008 7.36829 3.88741 7.24111 3.79364 7.14734C3.69987 7.05357 3.57269 7.00089 3.44008 7.00089C3.30748 7.00089 3.1803 7.05357 3.08653 7.14734C2.99276 7.24111 2.94008 7.36829 2.94008 7.50089H3.94008ZM19.0861 9.85489C19.18 9.94878 19.3073 10.0015 19.4401 10.0015C19.5729 10.0015 19.7002 9.94878 19.7941 9.85489C19.888 9.76101 19.9407 9.63367 19.9407 9.50089C19.9407 9.36812 19.888 9.24078 19.7941 9.14689L19.0861 9.85489ZM10.4401 0.500894L10.7941 0.146894C10.7476 0.100331 10.6925 0.0633878 10.6317 0.0381813C10.571 0.0129749 10.5059 0 10.4401 0C10.3743 0 10.3092 0.0129749 10.2485 0.0381813C10.1877 0.0633878 10.1325 0.100331 10.0861 0.146894L10.4401 0.500894ZM1.08608 9.14689C0.992198 9.24078 0.939453 9.36812 0.939453 9.50089C0.939453 9.63367 0.992198 9.76101 1.08608 9.85489C1.17997 9.94878 1.30731 10.0015 1.44008 10.0015C1.57286 10.0015 1.7002 9.94878 1.79408 9.85489L1.08608 9.14689ZM5.44008 19.0009H15.4401V18.0009H5.44008V19.0009ZM17.9401 16.5009V7.50089H16.9401V16.5009H17.9401ZM3.94008 16.5009V7.50089H2.94008V16.5009H3.94008ZM19.7941 9.14689L10.7941 0.146894L10.0861 0.854894L19.0861 9.85489L19.7941 9.14689ZM10.0861 0.146894L1.08608 9.14689L1.79408 9.85489L10.7941 0.854894L10.0861 0.146894ZM15.4401 19.0009C16.1031 19.0009 16.739 18.7375 17.2079 18.2687C17.6767 17.7998 17.9401 17.1639 17.9401 16.5009H16.9401C16.9401 16.8987 16.782 17.2802 16.5007 17.5616C16.2194 17.8429 15.8379 18.0009 15.4401 18.0009V19.0009ZM5.44008 18.0009C5.04226 18.0009 4.66073 17.8429 4.37942 17.5616C4.09812 17.2802 3.94008 16.8987 3.94008 16.5009H2.94008C2.94008 17.1639 3.20348 17.7998 3.67232 18.2687C4.14116 18.7375 4.77704 19.0009 5.44008 19.0009V18.0009Z" fill="white"/>
                        </svg>
                        <h5 className='text-white'> Home </h5>
                    </Link>
                    {user ? (
                    <Link className='nav-link' to={'/dashboard'}>
                        <svg width="20" height="21" viewBox="0 0 20 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.875 6.75V0.5H20V6.75H11.875ZM0 10.5V0.5H8.125V10.5H0ZM11.875 20.5V10.5H20V20.5H11.875ZM0 20.5V14.25H8.125V20.5H0ZM1.25 9.25H6.875V1.75H1.25V9.25ZM13.125 19.25H18.75V11.75H13.125V19.25ZM13.125 5.5H18.75V1.75H13.125V5.5ZM1.25 19.25H6.875V15.5H1.25V19.25Z" fill="white"/>
                        </svg>
                        <h5 className='text-white'> Dashboard </h5>
                    </Link>
                    ) : ( <></> )  }
                    <Link className='nav-link' to={'/settings'}>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fillRule="evenodd" clipRule="evenodd" d="M10 8.5C9.17157 8.5 8.5 9.17157 8.5 10C8.5 10.8284 9.17157 11.5 10 11.5C10.8284 11.5 11.5 10.8284 11.5 10C11.5 9.17157 10.8284 8.5 10 8.5ZM7.5 10C7.5 8.61929 8.61929 7.5 10 7.5C11.3807 7.5 12.5 8.61929 12.5 10C12.5 11.3807 11.3807 12.5 10 12.5C8.61929 12.5 7.5 11.3807 7.5 10Z" fill="white"/>
                        <path d="M3.39978 3.88004L3.64978 3.44604C3.55163 3.38929 3.4371 3.36758 3.32499 3.38448C3.21288 3.40138 3.10984 3.45588 3.03278 3.53904L3.39978 3.88004ZM1.40078 7.34404L0.922779 7.19604C0.889508 7.30425 0.893945 7.42055 0.935363 7.52591C0.97678 7.63127 1.05273 7.71945 1.15078 7.77604L1.40078 7.34404ZM1.39878 12.655L1.14878 12.222C1.05052 12.2787 0.974424 12.367 0.932994 12.4726C0.891563 12.5782 0.887256 12.6947 0.920779 12.803L1.39878 12.655ZM3.39878 16.119L3.03178 16.459C3.10884 16.5422 3.21188 16.5967 3.32399 16.6136C3.4361 16.6305 3.55063 16.6088 3.64878 16.552L3.39878 16.119ZM7.99878 18.774H7.49878C7.49872 18.8876 7.53731 18.9977 7.60819 19.0864C7.67907 19.1751 7.77803 19.2371 7.88878 19.262L7.99878 18.774ZM11.9998 18.776L12.1108 19.264C12.2213 19.2389 12.3201 19.1769 12.3908 19.0882C12.4614 18.9995 12.4999 18.8894 12.4998 18.776H11.9998ZM16.6008 16.12L16.3508 16.553C16.4489 16.6098 16.5635 16.6315 16.6756 16.6146C16.7877 16.5977 16.8907 16.5432 16.9678 16.46L16.6008 16.12ZM18.5988 12.654L19.0768 12.802C19.1101 12.6938 19.1056 12.5775 19.0642 12.4722C19.0228 12.3668 18.9468 12.2786 18.8488 12.222L18.5988 12.654ZM18.6008 7.34304L18.8508 7.77604C18.949 7.71941 19.0251 7.63106 19.0666 7.52548C19.108 7.41991 19.1123 7.30338 19.0788 7.19504L18.6008 7.34304ZM16.6008 3.87804L16.9678 3.53804C16.8907 3.45488 16.7877 3.40038 16.6756 3.38348C16.5635 3.36658 16.4489 3.38829 16.3508 3.44504L16.6008 3.87804ZM12.0008 1.22504H12.5008C12.5007 1.11181 12.4621 1.00198 12.3914 0.913508C12.3208 0.825039 12.2222 0.763175 12.1118 0.738038L12.0008 1.22504ZM8.00078 1.22304L7.88978 0.735038C7.77903 0.760016 7.68007 0.821944 7.60919 0.910636C7.53831 0.999328 7.49972 1.1095 7.49978 1.22304H8.00078ZM1.87878 7.49204C2.25429 6.2733 2.89921 5.15467 3.76578 4.21904L3.03278 3.53904C2.06391 4.58463 1.34276 5.83385 0.922779 7.19604L1.87878 7.49204ZM2.63878 14.25C2.32077 13.6997 2.06551 13.1153 1.87778 12.508L0.921779 12.804C1.13213 13.4825 1.41792 14.1353 1.77378 14.75L2.63878 14.25ZM3.76678 15.78C3.33511 15.3138 2.95608 14.8006 2.63878 14.25L1.77378 14.75C2.12822 15.3653 2.55053 15.9389 3.03278 16.46L3.76678 15.78ZM11.8898 18.29C10.6462 18.5728 9.35502 18.5721 8.11178 18.288L7.88978 19.262C9.27907 19.5797 10.722 19.5807 12.1118 19.265L11.8898 18.29ZM18.1228 12.508C17.7473 13.7268 17.1023 14.8454 16.2358 15.781L16.9688 16.461C17.9376 15.4154 18.6588 14.1652 19.0788 12.803L18.1228 12.508ZM17.3628 5.75004C17.6868 6.31304 17.9398 6.89704 18.1248 7.49204L19.0798 7.19604C18.8694 6.51756 18.5836 5.86481 18.2278 5.25004L17.3628 5.75004ZM16.2348 4.22004C16.6665 4.68631 17.0455 5.19952 17.3628 5.75004L18.2278 5.25004C17.8733 4.63478 17.451 4.0612 16.9688 3.54004L16.2348 4.22004ZM8.11178 1.71004C9.35532 1.42728 10.6465 1.42797 11.8898 1.71204L12.1118 0.738038C10.7225 0.420368 9.27952 0.419342 7.88978 0.735038L8.11178 1.71004ZM8.50078 3.07204V1.22204H7.50078V3.07204H8.50078ZM5.25078 4.37004L3.64978 3.44604L3.14978 4.31104L4.74978 5.23604L5.25078 4.37004ZM2.75078 11.298L1.14878 12.222L1.64978 13.088L3.24978 12.164L2.75078 11.298ZM3.25078 7.83404L1.65078 6.91104L1.15078 7.77704L2.75078 8.70004L3.25078 7.83404ZM8.50078 18.774V16.927H7.50078V18.774H8.50078ZM4.75078 14.762L3.14978 15.686L3.64978 16.552L5.24978 15.628L4.75078 14.762ZM16.8518 15.687L15.2508 14.762L14.7508 15.629L16.3508 16.553L16.8518 15.687ZM12.5008 18.777V16.927H11.5008V18.777H12.5008ZM18.3518 6.91004L16.7508 7.83404L17.2508 8.70004L18.8508 7.77604L18.3518 6.91004ZM18.8498 12.221L17.2508 11.3L16.7508 12.166L18.3508 13.089L18.8498 12.221ZM12.5008 3.07204V1.22504H11.5008V3.07204H12.5008ZM16.3518 3.44604L14.7508 4.37104L15.2508 5.23704L16.8518 4.31204L16.3518 3.44604ZM11.5008 3.07204C11.5008 4.99604 13.5838 6.19904 15.2508 5.23704L14.7508 4.37104C14.5227 4.50273 14.2639 4.57204 14.0005 4.572C13.7372 4.57196 13.4784 4.50256 13.2504 4.3708C13.0223 4.23903 12.833 4.04954 12.7014 3.82138C12.5698 3.59321 12.5006 3.33542 12.5008 3.07204H11.5008ZM16.7508 7.83504C15.0838 8.79704 15.0838 11.203 16.7508 12.165L17.2508 11.299C17.0228 11.1674 16.8334 10.978 16.7018 10.75C16.5702 10.522 16.5008 10.2633 16.5008 10C16.5008 9.73675 16.5702 9.47809 16.7018 9.25007C16.8334 9.02205 17.0228 8.8327 17.2508 8.70104L16.7508 7.83504ZM15.2508 14.763C13.5838 13.801 11.5008 15.002 11.5008 16.927H12.5008C12.5008 16.6637 12.5701 16.4061 12.7018 16.1781C12.8334 15.95 13.0228 15.7607 13.2508 15.629C13.4788 15.4974 13.7375 15.4281 14.0008 15.4281C14.2641 15.4281 14.5228 15.4974 14.7508 15.629L15.2508 14.763ZM8.50078 16.927C8.50078 15.003 6.41778 13.801 4.75078 14.763L5.25078 15.629C5.47888 15.4973 5.73763 15.428 6.00102 15.4281C6.26441 15.4281 6.52314 15.4975 6.7512 15.6293C6.97925 15.761 7.1686 15.9505 7.30018 16.1787C7.43176 16.4069 7.50095 16.6657 7.50078 16.929L8.50078 16.927ZM3.25078 12.165C4.91778 11.203 4.91778 8.79704 3.25078 7.83504L2.75078 8.70104C3.75078 9.27804 3.75078 10.72 2.75078 11.298L3.25078 12.165ZM7.50078 3.07204C7.5006 3.33526 7.43116 3.59379 7.29943 3.82167C7.1677 4.04956 6.97833 4.23877 6.75033 4.3703C6.52233 4.50183 6.26374 4.57105 6.00052 4.571C5.7373 4.57095 5.47873 4.50165 5.25078 4.37004L4.75078 5.23704C6.41778 6.19904 8.50078 4.99704 8.50078 3.07204H7.50078Z" fill="white"/>
                        </svg>
                        <h5 className='text-white'> Settings </h5>
                    </Link>
                    {user ? 
                        // If user is logged in, show their name and logout option
                        <>
                            <h5 className='text-white'>
                                {user.displayName && user.displayName.length > 6 
                                    ? `${user.displayName.substring(0, 6)}...` 
                                    : user.displayName || user.email}
                            </h5>
                            <button onClick={handleLogout} className="text-white">Logout</button>
                        </>
                     : 
                        // If user is not logged in, show the Signup link
                        <Link className='nav-link' to={'/signup'}>
                            <h5 className='normal text-white'> Signup </h5>
                        </Link>
                    }
                </div>
            </ul>
        </div>
    );
};

export default Navigation;
